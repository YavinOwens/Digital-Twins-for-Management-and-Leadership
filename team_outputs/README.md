# Team Outputs Module

This module handles the saving, organization, and management of outputs generated by the CrewAI multi-agent workflows.

## Structure

```
team_outputs/
├── __init__.py                    # Module initialization
├── output_manager.py              # Main output management functionality
├── test_output_saving.py          # Testing utilities
└── [workflow_outputs]/            # Generated output directories
    ├── [workflow_type]_[timestamp]/
    │   ├── index.md               # Main index file
    │   ├── metadata.json          # Workflow metadata
    │   ├── query.md               # Original query
    │   └── team_*.md              # Team outputs
```

## Key Components

### Team Output Manager
- **Structured Storage**: Organized file system for team outputs
- **Metadata Tracking**: Comprehensive metadata for each workflow
- **Index Generation**: Automatic index file creation
- **Query Preservation**: Original query storage and tracking

## Pseudocode Examples

### Main Output Saving
```python
def save_workflow_outputs(workflow_type: str, query: str, team_outputs: Dict[str, Any]) -> str:
    """
    Pseudocode for saving workflow outputs
    """
    # 1. Create timestamped directory
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    output_dir = Path(f"team_outputs/{workflow_type}_{timestamp}")
    output_dir.mkdir(exist_ok=True)
    
    # 2. Save query and metadata
    save_query_and_metadata(output_dir, query, metadata)
    
    # 3. Save individual team outputs
    for team_name, team_output in team_outputs.items():
        save_team_output(output_dir, team_name, team_output)
    
    # 4. Create index file
    create_index_file(output_dir, workflow_type, query, team_outputs)
    
    return str(output_dir)
```

### Team Output Formatting
```python
def format_team_output(team_name: str, team_output: str) -> str:
    """
    Pseudocode for formatting team output
    """
    # 1. Create header
    header = f"# {team_name} Output\n\n"
    
    # 2. Add metadata
    header += f"**Generated:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n"
    
    # 3. Add separator
    header += "---\n\n"
    
    # 4. Add content
    return header + team_output
```

### Index File Generation
```python
def create_index_file(output_dir: Path, workflow_type: str, query: str, team_outputs: Dict) -> None:
    """
    Pseudocode for creating index file
    """
    # 1. Create index content
    content = f"""# {workflow_type.replace('_', ' ').title()} Workflow Outputs

**Query:** {query}
**Generated:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

## Team Outputs

"""
    
    # 2. Add team links
    for i, team_name in enumerate(team_outputs.keys(), 1):
        filename = f"team_{sanitize_filename(team_name)}.md"
        content += f"{i}. [{team_name}]({filename})\n"
    
    # 3. Write file
    with open(output_dir / "index.md", 'w') as f:
        f.write(content)
```

## Usage Examples

### Basic Usage
```python
from team_outputs import save_team_outputs

# Save workflow outputs
output_dir = save_team_outputs(
    workflow_type="seven-team-workflow",
    query="Analyze digital twins in education",
    team_outputs={
        "research_analysis": "Research findings...",
        "data_strategy": "Data strategy...",
        "compliance_risk": "Compliance framework..."
    }
)
```

### Using Manager Class
```python
from team_outputs import TeamOutputManager

# Initialize manager
manager = TeamOutputManager()

# Save outputs
output_dir = manager.save_workflow_outputs(
    workflow_type="three-team-workflow",
    query="Test query",
    team_outputs=team_outputs
)

# List outputs
outputs = manager.list_workflow_outputs()
```

## File Organization

### Directory Structure
```
team_outputs/
├── seven-team-workflow_20240101_120000/
│   ├── index.md
│   ├── metadata.json
│   ├── query.md
│   ├── team_1_research_analysis.md
│   └── team_2_data_strategy.md
└── three-team-workflow_20240101_130000/
    ├── index.md
    ├── metadata.json
    └── query.md
```

### Metadata Format
```json
{
  "timestamp": "2024-01-01T12:00:00",
  "query": "Original query text",
  "workflow_type": "seven-team-workflow",
  "team_count": 7,
  "execution_time": 300.5,
  "status": "completed"
}
```

## Error Handling

### Safe File Operations
```python
def safe_file_write(file_path: Path, content: str) -> bool:
    """
    Pseudocode for safe file writing
    """
    try:
        # Create parent directories
        file_path.parent.mkdir(parents=True, exist_ok=True)
        
        # Write with temporary file
        temp_path = file_path.with_suffix('.tmp')
        with open(temp_path, 'w', encoding='utf-8') as f:
            f.write(content)
        
        # Atomic move
        temp_path.replace(file_path)
        return True
        
    except Exception as e:
        logging.error(f"Failed to write file: {e}")
        return False
```

## Testing

### Basic Tests
```python
def test_output_saving():
    """Test output saving functionality"""
    output_dir = save_team_outputs(
        workflow_type="test-workflow",
        query="Test query",
        team_outputs={"team1": "Test output"}
    )
    
    assert Path(output_dir).exists()
    assert (Path(output_dir) / "index.md").exists()
```